<html>

<head>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
    integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
    integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx"
    crossorigin="anonymous"></script>
  <link rel="stylesheet" href="data/master.css">
  <title>When.net (Testing)</title>
</head>

<body class="rainbow">
  <div class="jumbotron">
    <h1 class="display-4">Hello, world!</h1>
    <p class="lead">Welcome testers.</p>
    <hr class="my-4">
    <p>Please report any problems or suggestions to the link below.</p>
    <a class="btn btn-primary btn-lg"
      href="https://docs.google.com/forms/d/e/1FAIpQLSepdjOOBBJpFxnH3nsedO8GFMJ1rLCxbUSbAFw8OMpkW83Uog/viewform?usp=pp_url"
      role="button">Report</a>
  </div>
  <div class="sticky-top">
    <h1 class="title">
      When.net
    </h1>
    <p id="tips">
      Put tips here.
    </p>
  </div>
  <div class="inner">
    <div class="tap">
      <p><strong id="username">User</strong>, you have...</p>
      <h2 class="display-1" id="taps">9999999</h2>
      <p>with a <abbr title="Number of taps per press of space">tap rate</abbr> of...</p>
      <h2 class="display-1" id="rate">69 x 420</h2>
      <p>you can upgrade you <abbr title="The number to the left of the x">constant</abbr> at...</p>
      <h2 class="display-1" id="constup">9999999</h2>
      <p>you can upgrade you <abbr title="The number to the right of the x">mulitplier</abbr> at...</p>
      <h2 class="display-1" id="multiup">9999999</h2>
      <br>
      <br>
      <p>Press and hold <kbd>Space</kbd> to get taps</p>
      <p>Press <kbd>S</kbd> to save</p>
      <p>Press or hold <kbd>C</kbd> to upgrade the constant</p>
      <p>Press or hold <kbd>M</kbd> to upgrade the multiplier</p>
    </div>
  </div>
  <table class="table table-hover">
    <thead>
      <tr>
        <th scope="col">#</th>
        <th scope="col">First</th>
        <th scope="col">Last</th>
        <th scope="col">Handle</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <th scope="row">1</th>
        <td>Mark</td>
        <td>Otto</td>
        <td>@mdo</td>
      </tr>
      <tr>
        <th scope="row">2</th>
        <td>Jacob</td>
        <td>Thornton</td>
        <td>@fat</td>
      </tr>
      <tr>
        <th scope="row">3</th>
        <td colspan="2">Larry the Bird</td>
        <td>@twitter</td>
      </tr>
    </tbody>
  </table>
  <!-- The core Firebase JS SDK is always required and must be listed first -->
  <script src="https://www.gstatic.com/firebasejs/7.24.0/firebase-app.js"></script>

  <!-- TODO: Add SDKs for Firebase products that you want to use
        https://firebase.google.com/docs/web/setup#available-libraries -->
  <script src="https://www.gstatic.com/firebasejs/7.24.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.24.0/firebase-firestore.js"></script>

  <script>
    // Your web app's Firebase configuration
    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
    var firebaseConfig = {
      apiKey: "AIzaSyBgKnmWvumcDMHCejaefJOI_Ugy8UavWfE",
      authDomain: "whennet.firebaseapp.com",
      databaseURL: "https://whennet.firebaseio.com",
      projectId: "whennet",
      storageBucket: "whennet.appspot.com",
      messagingSenderId: "264909343107",
      appId: "1:264909343107:web:226446c52a61d15e020eb6",
      measurementId: "G-5EP63WZF3H"
    };
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    var db = firebase.firestore();

    var email = window.localStorage.getItem("email");
    var userRef = db.collection('users').doc(email)

    userRef.get().then(function (doc) {
          if (doc.exists) { //if the user has account load values into localstorage
            var data = doc.data()
            window.localStorage.setItem('taps', data['taps'])
            window.localStorage.setItem('constant', data['constant'])
            window.localStorage.setItem('multiplier', data['multiplier'])
            window.localStorage.setItem('multipliertier', data['multipliertier'])
            window.localStorage.setItem('constanttier', data['constanttier'])
            window.localStorage.setItem('name', data['name'])
            console.log(data)
          };
    });

    var taps = parseInt(window.localStorage.getItem('taps'));
    var constant = parseInt(window.localStorage.getItem('constant'));
    var multiplier = parseInt(window.localStorage.getItem('multiplier'));
    var constanttier = parseInt(window.localStorage.getItem('constanttier'));
    var multipliertier = parseInt(window.localStorage.getItem('multipliertier'));
    var constcost = 1 * Math.pow(constanttier, 2);
    var multicost = 2 * Math.pow(multipliertier, 3);
    console

    var tipslist = [
      'cool beans',
      'Just hold space!',
      'git gud',
      'Buy some stuff',
      'Every 60 seconds in Africa, a minute passes',
      'Smack it like you mean it!'
    ]

    document.getElementById('username').innerHTML = window.localStorage.getItem('name');
    Update();

    document.getElementById("tips").innerHTML = tipslist[Math.floor(Math.random() * tipslist.length)];

    window.addEventListener("keydown", function (event) {
      if (event.defaultPrevented) {
        return; // Do nothing if the event was already processed
      }

      switch (event.key) {
        case " ":
          Tap();
          break;
        case "s":
          Save();
          break;
        case "c":
          ConstantUp();
          break;
        case "m":
          MultiplierUp();
          break;
        default:
          return; // Quit when this doesn't handle the key event.
      }

      // Cancel the default action to avoid it being handled twice
      event.preventDefault();
    }, true);

    function Tap() {
      taps += constant * multiplier;
      Update();
    };

    function Update() {
      document.getElementById('taps').innerHTML = taps;
      document.getElementById('rate').innerHTML = constant + " x " + multiplier;
      document.getElementById('constup').innerHTML = constcost;
      document.getElementById('multiup').innerHTML = multicost;
    };

    function ConstantUp() {
      if (taps >= constcost) {
        constanttier += 1;
        constant += 1;
        taps -= constcost;
        constcost = Math.pow(2, constanttier);
      };
      Update();
    };

    function MultiplierUp() {
      if (taps >= multicost) {
        multipliertier += 1;
        multiplier += 1;
        taps -= multicost;
        multicost = 2 * Math.pow(3, multipliertier);
      };
      Update();
    };

    function Save() {
      return userRef.update({
        taps: taps,
        constant: constant,
        multiplier: multiplier,
        constanttier: constanttier,
        multipliertier: multipliertier
      })
    };
  </script>
</body>

</html>